# p2pchat
使用socket网络编程和linuxPOSIX多线程实现的p2p聊天,包括私聊和群聊

用法:
启动服务器: ./server
进入客户端进行聊天: ./main

# 核心功能与技术原理
p2p聊天系统是我在linux下使用c/c++开发的一个个人学习项目,核心功能和技术原理如下：

首先用户通过客户端登陆服务器,服务器保存当前登陆用户的信息,然后向其他在线用户发送新用户上线通知,
同时用户下线时,服务器也向其他用户发送用户下线通知;
用户上线后可以向服务器发送显示当前在线用户的请求,服务器向用户返回当前在线用户列表;
用户获得当前在线用户列表后可以向当前在线的用户发送私聊和群聊消息.

实现方面的话,首先是服务器端设计,我使用的是单进程多线程的模型来支持并发,同时为了控制访问量和提供响应速度,我设计了一个
线程池来保存一些列的线程,在服务器启动的时候创建这些线程.
其次是使全部线程都去监听套接口,使用互斥锁和条件变量做并发控制,保证任何时候只有一个线程处于监听状态;
当请求到来,建立连接后,监听线程变为工作线程,修改条件变量释放互斥锁,只唤醒空闲线程池中之前第一个请求获取条件变量的线程;

其次是客户端,客户端使用TCP与服务器建立连接,建立连接后向服务器发送一个空的udp包,目的是服务器在接收到这个udp包后会保存
该用户的ip和udp端口到服务器上的一个列表,用于表示在线用户,同时ip和udp用于用户之后的私聊和群聊.
用户在上线后请求的在线用户列表中,保存的就是其他用户的ip和udp端口号,这样用户就可以使用udp协议与其他用户私聊和群聊.

最后是数据包,由于客户端与服务器交互涉及到多种类型的数据,例如上线,下线,请求在线用户列表,我设计了一个数据包,该数据包,由消息类型,消息内容和
内容长度组成,从而使服务器在接收到消息时根据消息的不同采取不同的操作. 并且重写了read, write系统调用,用来保证整个包发送完整,避免粘包问题.





 
